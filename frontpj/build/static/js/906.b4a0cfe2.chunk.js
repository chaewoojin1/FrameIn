"use strict";(self.webpackChunkfrontpj=self.webpackChunkfrontpj||[]).push([[906],{3697:(e,a,s)=>{s.d(a,{A:()=>i});var n=s(5043),t=s(579);const o=n.memo((e=>{let{mapRef:a,isKomoranOpen:s,cinemas:o,lastLocation:r,markers:i,onMapRendered:l}=e;return(0,n.useEffect)((()=>{var e;if(a.current&&(a.current.style.width="500px",a.current.style.height="300px",a.current.style.display=s?"block":"none",null!==(e=window.kakao)&&void 0!==e&&e.maps)){const e={center:new window.kakao.maps.LatLng(37.5665,126.978),level:7},s=new window.kakao.maps.Map(a.current,e);if(o.length>0){const{lat:e,lon:a}=o[0];s.setCenter(new window.kakao.maps.LatLng(e,a)),o.forEach((e=>{const a=new window.kakao.maps.LatLng(e.lat,e.lon),n=new window.kakao.maps.Marker({position:a});n.setMap(s);const t=new window.kakao.maps.InfoWindow({content:`<div>${e.cinemaName}<br>${e.address}</div>`});window.kakao.maps.event.addListener(n,"click",(()=>{t.open(s,n)}))}))}else if(r){const{lat:e,lon:a}=r;s.setCenter(new window.kakao.maps.LatLng(e,a)),i.forEach((e=>{const a=new window.kakao.maps.LatLng(e.lat,e.lon),n=new window.kakao.maps.Marker({position:a});n.setMap(s);const t=new window.kakao.maps.InfoWindow({content:`<div>${e.cinemaName}<br>${e.address}</div>`});window.kakao.maps.event.addListener(n,"click",(()=>{t.open(s,n)}))}))}l&&l()}}),[a,s,o,r,i,l]),(0,t.jsx)("div",{id:"map",ref:a})})),r=n.memo((e=>{let{sender:a,content:s,isLastBotMessage:n,isLatestMap:r,isFirstMessage:i,mapRef:l,isKomoranOpen:c,cinemas:d,lastLocation:m,markers:p,onMapRendered:u,showTime:h}=e;return(0,t.jsxs)("div",{className:`${a}-chat`,style:i?{display:"none"}:{},children:[h&&(0,t.jsx)("div",{className:"time-display",children:(0,t.jsx)("p",{children:h})}),(0,t.jsx)("div",{className:"message",children:(0,t.jsxs)("div",{className:"part",children:["bot"===a&&n&&(0,t.jsx)("div",{className:"chat-body-logo",children:(0,t.jsx)("img",{src:"/image/logo.png",alt:"logo",id:"logo"})}),"map"===s?r?(0,t.jsx)(o,{mapRef:l,isKomoranOpen:c,cinemas:d,lastLocation:m,markers:p,onMapRendered:u}):(0,t.jsx)("p",{children:"\uc9c0\ub3c4\uac00 \uc5c5\ub370\uc774\ud2b8 \ub418\uc5c8\uc2b5\ub2c8\ub2e4."}):(0,t.jsx)("p",{className:"message-content",dangerouslySetInnerHTML:{__html:s}})]})})]})})),i=()=>{const[e,a]=(0,n.useState)(""),[s,o]=(0,n.useState)(null),[i,l]=(0,n.useState)([]),[c,d]=(0,n.useState)(null),[m,p]=(0,n.useState)([]),[u,h]=(0,n.useState)(!1),[g,w]=(0,n.useState)(!0),[k,f]=(0,n.useState)([]),[v,x]=(0,n.useState)(null),j=(0,n.useRef)(null),L=(0,n.useRef)(null),b=(0,n.useRef)(null);(0,n.useEffect)((()=>{b.current.focus()}),[]);const y=(0,n.useCallback)((()=>{var e;if(null!==(e=window.kakao)&&void 0!==e&&e.maps)return void h(!0);const a=document.createElement("script");a.src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=190b60adafceaaa9f23691a7db8a0b39&autoload=false&libraries=services",a.async=!0,a.onload=()=>{window.kakao.maps.load((()=>{h(!0),console.log("\uce74\uce74\uc624\ub9f5 API \ub85c\ub4dc \uc131\uacf5")}))},a.onerror=()=>console.error("\uce74\uce74\uc624\ub9f5 API \ub85c\ub4dc \uc2e4\ud328"),document.head.appendChild(a)}),[]),N=(0,n.useCallback)((()=>{j.current&&(j.current.scrollTop=j.current.scrollHeight)}),[]);(0,n.useEffect)((()=>{N()}),[k,N]),(0,n.useEffect)((()=>{y(),$("\uc548\ub155")}),[y]),(0,n.useEffect)((()=>{if(s){const{poster_path:e,movieNm:a,openDt:n,audiAcc:t,overview:o}=s;M(e?`<img src="${e}" alt="${a} \ud3ec\uc2a4\ud130" class="movie-poster" />`:"\ud3ec\uc2a4\ud130 \uc774\ubbf8\uc9c0 \uc5c6\uc74c"),M(`\uc601\ud654 \uc774\ub984: ${a}`),M(`\uac1c\ubd09\uc77c: ${n}`),M(`\ub204\uc801 \uad00\uac1d\uc218: ${Number(t).toLocaleString("ko-KR")}\uba85`),M(`\uc904\uac70\ub9ac: ${o}`)}i.length>0&&u&&setTimeout((()=>{M("map")}),100)}),[s,i,u]);const M=(0,n.useCallback)((e=>{e&&f((a=>{const s=[...a,{sender:"bot",content:e,time:new Date}];return x(s.length-1),s}))}),[]),C=(0,n.useCallback)((async e=>{try{const a=await fetch("http://43.201.20.172:8090/botController",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({message:e})}),s=await a.json(),{answer:n}=s;if(i.length>0){const{lat:e,lon:a}=i[0];d({lat:e,lon:a}),p(i.map((e=>({lat:e.lat,lon:e.lon,cinemaName:e.cinemaName,address:e.address}))))}l([]),o(null),Array.isArray(n.message)?n.message.forEach((e=>M(e.message))):M(n.message),n.cinemaList&&n.cinemaList.length>0?l(n.cinemaList):n.movie&&o(n.movie),n.content&&M(n.content)}catch(a){console.error("Error sending message:",a)}}),[i,M]),$=(0,n.useCallback)((async e=>{const s=e.trim();s.length<2||(f((e=>[...e,{sender:"user",content:s,time:new Date}])),a(""),L.current&&(L.current.innerHTML="",L.current.style.width="0px",L.current.style.height="0px"),await C(s))}),[C]),R=e=>{const a=e||new Date;let s=a.getHours();const n=s>=12?"\uc624\ud6c4":"\uc624\uc804";s=s%12||12;const t=a.getMinutes();return`${n} ${s}:${t<10?"0"+t:t}`};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"komoran-container "+(g?"open":"closed"),children:[(0,t.jsxs)("div",{className:"komoran-header",children:[(0,t.jsx)("div",{className:"chat-header-logo",children:(0,t.jsx)("img",{src:"/image/logo.png",alt:"logo",id:"logo"})}),(0,t.jsx)("div",{className:"header-title",children:"Frame In"})]}),(0,t.jsxs)("div",{className:"komoran-body",ref:j,children:[(0,t.jsxs)("div",{id:"default",children:[(0,t.jsx)("div",{className:"default-img",children:(0,t.jsx)("img",{src:"/image/logo.png",alt:"logo",id:"logo"})}),(0,t.jsx)("p",{children:(0,t.jsx)("b",{children:"Frame In\uc5d0 \ubb38\uc758\ud558\uae30"})})]}),k.map(((e,a)=>{var s;let o=!1;if("map"===e.content){o=a===k.map((e=>e.content)).lastIndexOf("map")}const l=0===a&&"\uc548\ub155"===e.content,d=0===a||a>0&&R(e.time)!==R(k[a-1].time),p="bot"===e.sender&&(a===k.length-1||"user"===(null===(s=k[a+1])||void 0===s?void 0:s.sender));return(0,t.jsxs)(n.Fragment,{children:[d&&(0,t.jsx)("div",{className:"time-display",children:(0,t.jsx)("p",{children:R(e.time)})}),(0,t.jsx)(r,{sender:e.sender,content:e.content,isLastBotMessage:p,isLatestMap:o,isFirstMessage:l,mapRef:L,isKomoranOpen:g,cinemas:i,lastLocation:c,markers:m,onMapRendered:N})]},a)}))]}),(0,t.jsxs)("div",{className:"message-input",children:[(0,t.jsx)("input",{type:"text",value:e,onChange:e=>a(e.target.value),onKeyDown:a=>{"Enter"===a.key&&$(e)},ref:b}),(0,t.jsx)("button",{onClick:()=>{$(e)},children:"\uc804\uc1a1"})]})]}),(0,t.jsx)("div",{className:"chat-float-button",onClick:()=>{w((e=>!e))},children:"\ucc44\ud305"})]})}},5906:(e,a,s)=>{s.r(a),s.d(a,{default:()=>o});s(5043);var n=s(3697),t=s(579);const o=()=>(0,t.jsx)(n.A,{})}}]);
//# sourceMappingURL=906.b4a0cfe2.chunk.js.map