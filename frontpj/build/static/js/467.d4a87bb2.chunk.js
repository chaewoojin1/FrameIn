"use strict";(self.webpackChunkfrontpj=self.webpackChunkfrontpj||[]).push([[467],{6467:(e,t,s)=>{s.r(t),s.d(t,{default:()=>o});var n=s(5043),c=s(3003),r=s(6213),a=s(579);const l=()=>{const e=(0,c.d4)((e=>e.loginSlice)),t=(0,n.useRef)(null),[s,l]=(0,n.useState)(""),[o,i]=(0,n.useState)([]),u=(0,n.useRef)(null);(0,n.useEffect)((()=>(t.current=new WebSocket("ws://43.201.20.172:8090/chat"),t.current.onopen=()=>{if(console.log("\uc6f9\uc18c\ucf13 \uc5f0\uacb0 \uc131\uacf5"),t.current&&t.current.readyState===WebSocket.OPEN){const s=`email:${e.email}`;t.current.send(s)}},t.current.onmessage=t=>{const s=h(),[n,c,...r]=t.data.split(":"),a=r.join(":").trim();n!==e.email&&i((e=>{const t=[...e,{type:"received",text:a,time:s,sender:n,senderNickname:c}];return localStorage.setItem("chatMessages",JSON.stringify(t)),t}))},t.current.onclose=()=>{console.log("\uc6f9\uc18c\ucf13 \uc5f0\uacb0 \uc885\ub8cc")},()=>{t.current&&t.current.close()})),[]);const m=async()=>{if(s.trim())if(t.current&&t.current.readyState===WebSocket.OPEN){const c=h(),a=`${e.email}:${e.nickname}:${s}`;t.current.send(a);try{await r.A.post("http://43.201.20.172:8090/api/chat/messages",{sender:e.email,message:s}),console.log("\uba54\uc2dc\uc9c0\uac00 REST API\uc5d0 \uc804\uc1a1\ub418\uc5c8\uc2b5\ub2c8\ub2e4.")}catch(n){console.error("REST API \uba54\uc2dc\uc9c0 \uc804\uc1a1 \uc2e4\ud328:",n)}i((t=>{const n=[...t,{type:"sent",text:s,time:c,sender:e.email,senderNickname:e.nickname}];return localStorage.setItem("chatMessages",JSON.stringify(n)),n})),l("")}else console.log("\uc6f9\uc18c\ucf13 \uc5f0\uacb0\uc774 \ub418\uc5b4 \uc788\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.");else console.log("\ube48 \uba54\uc2dc\uc9c0\ub294 \uc804\uc1a1\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.")};(0,n.useEffect)((()=>{u.current&&(u.current.scrollTop=u.current.scrollHeight)}),[o]),(0,n.useEffect)((()=>{const e=localStorage.getItem("chatMessages");e&&i(JSON.parse(e))}),[]);const d=e=>{const t=e.split(":");return t.length>1?t.slice(1).join(":").trim():e},h=e=>{const t=e||new Date;let s=t.getHours();const n=s>=12?"\uc624\ud6c4":"\uc624\uc804";s=s%12||12;const c=t.getMinutes();return`${n} ${s}:${c<10?"0"+c:c}`};return(0,a.jsx)("div",{className:"chatContainer",children:(0,a.jsxs)("div",{className:"chatContent",children:[(0,a.jsx)("div",{className:"chatHeader",children:(0,a.jsx)("div",{children:"\uc601\ud654 \ucc44\ud305\ubc29"})}),(0,a.jsx)("div",{className:"chatBox",ref:u,children:o.map(((t,s)=>{const n=s>0&&o[s-1].time===t.time;return(0,a.jsxs)(a.Fragment,{children:[!n&&(0,a.jsx)("div",{className:"msgTime",children:(0,a.jsx)("span",{children:t.time})}),(0,a.jsx)("div",{className:"message",style:{justifyContent:t.sender===e.email?"flex-end":"flex-start"},children:(0,a.jsxs)("div",{className:"messageText",children:[t.sender!==e.email&&(0,a.jsx)("strong",{children:t.senderNickname})," ",d(t.text)," "]})},s)]})}))}),(0,a.jsxs)("div",{className:"inputContainer",children:[(0,a.jsx)("input",{type:"text",value:s,onChange:e=>{l(e.target.value)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(m(),e.preventDefault())},placeholder:"\uba54\uc2dc\uc9c0\ub97c \uc785\ub825\ud558\uc138\uc694",className:"input"}),(0,a.jsx)("button",{onClick:m,className:"button",children:"\uc804\uc1a1"})]}),e.roleNames.includes("ADMIN")&&(0,a.jsx)("div",{className:"adminButton",children:(0,a.jsx)("button",{onClick:()=>{localStorage.removeItem("chatMessages"),i([]),console.log("\ub85c\uceec \uc2a4\ud1a0\ub9ac\uc9c0\uc5d0 \uc800\uc7a5\ub41c \uba54\uc2dc\uc9c0\uac00 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4.")},className:"clearButton",children:"\uc800\uc7a5\ub41c \uba54\uc2dc\uc9c0 \uc9c0\uc6b0\uae30"})})]})})},o=()=>(0,a.jsx)(l,{})}}]);
//# sourceMappingURL=467.d4a87bb2.chunk.js.map